<script src="https://cdn.jsdelivr.net/npm/@widgetbot/html-embed"></script>

<div class="discord-messages-container" style="max-width: 1000px; margin: 0 auto 40px auto; border: 1px solid #30363d; border-radius: 12px; background: #161b22; overflow: hidden;">
    <div class="discord-sync-header" style="padding: 12px 20px; background: #1c2128; border-bottom: 1px solid #30363d; font-weight: bold; color: #3fb950; display: flex; align-items: center; gap: 10px;">
        <i class="fab fa-discord"></i> 近期公告訊息同步
    </div>
    <discord-messages 
        server="1426193407130341408" 
        channel="1471871257472532591"
        style="width: 100%; height: 400px; background: transparent;">
    </discord-messages>
</div>

<script>
    // 修復玩家清單的 Bug，確保頭像跟名字能對齊，且濾掉 Anonymous
    async function updateServerInfo() {
        const ip = "ryfn.falix.gg";
        try {
            const res = await fetch(`https://api.mcstatus.io/v2/status/java/${ip}`);
            const data = await res.json();
            if (data.online) {
                // ... 你原本的更新人數與狀態邏輯 ...

                const pList = document.getElementById('player-list');
                if (data.players.list && data.players.list.length > 0) {
                    pList.innerHTML = data.players.list.map(p => {
                        const name = p.name_clean || p.name;
                        // 修正 1：濾掉 Anonymous
                        if (!name || name.toLowerCase().includes('anonymous')) return '';
                        // 修正 2：確保頭像 API 正確讀取名字
                        return `
                            <div class="player-card" style="text-align: center; background: #161b22; padding: 15px; border-radius: 10px; border: 1px solid #30363d; width: 120px; transition: 0.3s;">
                                <img src="https://mc-heads.net/avatar/${name}/80" alt="${name}" style="width: 80px; height: 80px; image-rendering: pixelated; border-radius: 5px;">
                                <div style="color:#3fb950; font-size:0.8rem; margin-top:5px; font-weight:bold;">${name}</div>
                            </div>
                        `;
                    }).join('');
                }
            }
        } catch (e) { console.error(e); }
    }
    updateServerInfo();
    setInterval(updateServerInfo, 30000);
</script>
